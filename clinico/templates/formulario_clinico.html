{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONTROL DE TRABAJO DE PARTO</title>
    <link rel="stylesheet"  href="{% static 'css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
    <form id="formulario-clinico" method="post">
        <div class="form-container">
            <!-- Encabezado del Formulario -->
            <div class="form-header">
                <div class="header-left">
                    <div class="logo-section">
                        <div class="logo-box">
                            <img src="{% static 'img/logo_hospital.png' %}" alt="Logo Hospital">
                        </div>
                        
                    </div>
                </div>
                <div class="header-center">
                    <h1>CONTROL DE TRABAJO DE PARTO</h1>
                </div>
                <div class="header-right">
                    <div class="code-box">
                        <div><input type="text" id="codigo" name="codigo" value="" class="header-input header-input-static" required maxlength="255" placeholder="C√ìDIGO" readonly></div>
                        <div class="header-static-chip">FRSPA-022</div>
                        <div class="header-static-chip">VERSI√ìN</div>
                        <div><input type="text" id="version" name="version" value="01" class="header-input header-input-static" required maxlength="50" placeholder="VERSI√ìN" readonly></div>
                        <div class="header-chip-side">
                            <div class="header-static-chip">FECHA DE ELABORACI√ìN</div>
                            <div class="header-static-chip">2 DE MARZO DEL 2018</div>
                            <div class="header-static-chip">FECHA DE ACTUALIZACI√ìN</div>
                            <div class="header-static-chip">2 DE MARZO DEL 2018</div>
                        </div>
                    </div>
                    
                </div>
                <div class="header-top-right">
                    <img class="accreditation-img" src="{% static 'img/logo_acreditacion.png' %}" alt="Logo Acreditaci√≥n">
                </div>
            </div>
            <div class="meta-box">
            <div class="page-info">
                HOJA: <input type="number" id="num_hoja" name="num_hoja" value="1" min="1" class="page-input" required placeholder="HOJA"> DE: 1
            </div>

            <!-- Campos ocultos para IDs -->
            <input type="hidden" id="paciente_id" name="paciente_id">
            <input type="hidden" id="formulario_id" name="formulario_id">

            <!-- B√∫squeda de Paciente -->
            <div style="margin-bottom: 15px; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
                <input type="text" id="documento" placeholder="Documento del paciente" 
                       style="padding: 8px; margin-right: 10px; width: 300px; border: 1px solid #ccc; border-radius: 4px;">
                <button type="button" id="btnBuscarPaciente" 
                        style="padding: 8px 20px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    BUSCAR PACIENTE
                </button>
                <div id="resultadoPaciente" style="margin-top: 10px;"></div>
            </div>

            <!-- Informaci√≥n del Paciente -->
            <div class="patient-info-section">
                <table class="patient-table">
                    <tr>
                        <td class="label-cell">DD/MM/AA</td>
                        <td class="input-cell">
                            <input type="date" id="fecha_elabora_paciente" name="fecha_elabora_paciente" class="form-input">
                        </td>
                        <td class="label-cell">ASEGURADORA</td>
                        <td class="input-cell">
                            <select id="aseguradora_id" name="aseguradora_id" class="form-input">
                                <option value="">Seleccione...</option>
                                <!-- Se llenar√° din√°micamente con JavaScript -->
                            </select>
                        </td>
                        <td class="label-cell">N¬∞ HISTORIA CL√çNICA</td>
                        <td class="input-cell">
                            <input type="text" id="num_historia_clinica" name="num_historia_clinica" 
                                   class="form-input" maxlength="255" required>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">CC. IDENTIFICACI√ìN</td>
                        <td class="input-cell">
                            <div style="display: flex; gap: 5px;">
                                <input type="text" id="num_identificacion" name="num_identificacion" 
                                       class="form-input" maxlength="255" required style="flex: 1;">
                                <button type="button" id="btn-buscar-paciente-cedula" 
                                        style="padding: 5px 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    üîç Buscar
                                </button>
                            </div>
                        </td>
                        <td class="label-cell">NOMBRE Y APELLIDO</td>
                        <td class="input-cell wide-input" colspan="3">
                            <input type="text" id="nombres" name="nombres" 
                                   class="form-input" maxlength="255" required>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">DIAGN√ìSTICO</td>
                        <td class="input-cell" colspan="2">
                            <textarea id="diagnostico" name="diagnostico" 
                                      class="form-input" rows="2"></textarea>
                        </td>
                        <td class="label-cell">EDAD</td>
                        <td class="input-cell">
                            <input type="number" id="edad_snapshot" name="edad_snapshot" 
                                   class="form-input" min="0" step="1">
                        </td>
                        <td class="label-cell">GRUPO SANGU√çNEO</td>
                        <td class="input-cell">
                            <select id="tipo_sangre" name="tipo_sangre" class="form-input">
                                <option value="">Seleccione...</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">EDAD GESTACIONAL</td>
                        <td class="input-cell">
                            <input type="number" id="edad_gestion" name="edad_gestion" 
                                   class="form-input" min="0" step="1">
                        </td>
                        <td class="label-cell">G_P_C_A_V_M_</td>
                        <td class="input-cell">
                            <select id="estado" name="estado" class="form-input" required>
                                <option value="">Seleccione...</option>
                                <option value="g">G</option>
                                <option value="p">P</option>
                                <option value="c">C</option>
                                <option value="a">A</option>
                                <option value="v">V</option>
                                <option value="m">M</option>
                            </select>
                        </td>
                        <td class="label-cell label-cell-center">N¬∞ CONTROLES PRENATALES</td>
                        <td class="input-cell">
                            <input type="number" id="n_controles_prenatales" name="n_controles_prenatales" 
                                   class="form-input" min="0" step="1">
                        </td>
                    </tr>
                </table>
            </div>
            </div>

            <!-- Tabla Principal de Control -->
            <div class="main-control-table">
                <table class="control-grid">
                    <thead>
                        <tr>
                            <th rowspan="2" class="item-col">ITEM</th>
                            <th rowspan="2" class="param-col">PAR√ÅMETRO</th>
                            <th colspan="10" class="time-header">HORA</th>
                        </tr>
                        <tr class="time-row">
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="0" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="1" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="2" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="3" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="4" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="5" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="6" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="7" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="8" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                            <th class="time-cell">
                                <input type="datetime-local" class="time-input" 
                                       data-hora-index="9" placeholder="DD/MM/AAAA HH:MM">
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <!-- {{ item.nombre|upper }} -->
                        <tr class="section-header">
                            <td colspan="12" class="section-title">{{ item.nombre|upper }}</td>
                        </tr>
                        {% for parametro in item.parametros.all %}
                        <tr>
                            {% if forloop.first %}
                            <td class="item-num" data-item-id="{{ item.id }}" rowspan="{{ item.parametros.count }}">{{ item.nombre }}</td>
                            {% endif %}
                            <td class="param-name" data-parametro-id="{{ parametro.id }}" data-parametro-nombre="{{ parametro.nombre|upper }}">{{ parametro.nombre|upper }}</td>
                            {% for hora_index in "0123456789"|make_list|slice:":10" %}
                            <td class="data-cell">
                                <div class="cell-inputs">
                                    {% for campo in parametro.campos.all %}
                                    <div class="input-group">
                                        {% if parametro.campos.count > 1 %}
                                        <span class="field-label">{{ campo.nombre|slice:":3" }}</span>
                                        {% endif %}
                                        <input type="text" 
                                               class="data-input" 
                                               data-parametro-id="{{ parametro.id }}" 
                                               data-campo-id="{{ campo.id }}"
                                               data-hora-index="{{ forloop.parentloop.counter0 }}" 
                                               data-tipo-valor="{{ campo.tipo_valor }}" 
                                               placeholder="{{ campo.nombre }}">
                                    </div>
                                    {% endfor %}
                                </div>
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pie del Formulario -->
            <div class="form-footer">
                <div class="responsible-field">
                    <label>RESPONSABLE:</label>
                    <input type="text" id="responsable" name="responsable" 
                           class="responsible-input" required maxlength="255">
                </div>
                <div class="form-actions">
                    <button type="submit" id="btn-guardar" class="btn btn-primary">Guardar Formulario</button>
                    <button type="button" id="btnGenerarPDF" class="btn btn-secondary" onclick="descargarPDF()">Descargar PDF</button>
                </div>
            </div>
        </div>
    </form>
    
    <!-- Secci√≥n Colapsable -->
    <div class="collapsible-section">
        <button class="collapsible-btn" onclick="toggleCollapsible()">
            <span class="collapsible-icon" id="collapsible-icon">‚ñº</span>
            <span>Datos guardados en el formulario</span>
        </button>
        <div class="collapsible-content" id="collapsible-content" style="display: none;">
            <div class="collapsible-body">
                <!-- Informaci√≥n del Paciente -->
                <div class="patient-info-section">
                    <table class="patient-table">
                        <tr>
                            <td class="label-cell">DD/MM/AA</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                            <td class="label-cell">ASEGURADORA</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                            <td class="label-cell">N¬∞ HISTORIA CL√çNICA</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="label-cell">CC. IDENTIFICACI√ìN</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                            <td class="label-cell">NOMBRE Y APELLIDO</td>
                            <td class="input-cell wide-input" colspan="3">
                                <span class="info-value"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="label-cell">DIAGN√ìSTICO</td>
                            <td class="input-cell" colspan="2">
                                <span class="info-value"></span>
                            </td>
                            <td class="label-cell">EDAD</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                            <td class="label-cell">GRUPO SANGU√çNEO</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                        </tr>
                        <tr>
                            <td class="label-cell">EDAD GESTACIONAL</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                            <td class="label-cell">G_P_C_A_V_M_</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                            <td class="label-cell label-cell-center">N¬∞ CONTROLES PRENATALES</td>
                            <td class="input-cell">
                                <span class="info-value"></span>
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Tabla Principal de Control -->
                <div class="main-control-table">
                    <table class="control-grid">
                        <thead>
                            <tr>
                                <th rowspan="2" class="item-col">ITEM</th>
                                <th rowspan="2" class="param-col">PAR√ÅMETRO</th>
                                <th colspan="10" class="time-header">HORA</th>
                            </tr>
                            <tr class="time-row">
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 08:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 09:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 10:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 11:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 12:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 13:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 14:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 15:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 16:00</span>
                                </th>
                                <th class="time-cell">
                                    <span class="info-time">15/12/2024 17:00</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                            <!-- {{ item.nombre|upper }} -->
                            <tr class="section-header">
                                <td colspan="12" class="section-title">{{ item.nombre|upper }}</td>
                            </tr>
                            {% for parametro in item.parametros.all %}
                            <tr>
                                {% if forloop.first %}
                                <td class="item-num" data-item-id="{{ item.id }}" rowspan="{{ item.parametros.count }}">{{ item.nombre }}</td>
                                {% endif %}
                                <td class="param-name" data-parametro-id="{{ parametro.id }}" data-parametro-nombre="{{ parametro.nombre|upper }}">{{ parametro.nombre|upper }}</td>
                                {% for hora_index in "0123456789"|make_list|slice:":10" %}
                                <td class="data-cell">
                                    <div class="cell-inputs">
                                        {% for campo in parametro.campos.all %}
                                        <div class="input-group">
                                            {% if parametro.campos.count > 1 %}
                                            <span class="field-label">{{ campo.nombre|slice:":3" }}</span>
                                            {% endif %}
                                            <span class="info-value" 
                                                  data-parametro-id="{{ parametro.id }}" 
                                                  data-campo-id="{{ campo.id }}"
                                                  data-hora-index="{{ forloop.parentloop.counter0 }}">-</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Pie del Formulario -->
                <div class="form-footer" style="border-top: 2px solid var(--color-borde, #e5e7eb); margin-top: 1rem; padding-top: 1rem;">
                    <div class="responsible-field">
                        <label>RESPONSABLE:</label>
                        <span class="info-value"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        function toggleCollapsible() {
            const content = document.getElementById('collapsible-content');
            const icon = document.getElementById('collapsible-icon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.classList.remove('rotated');
            } else {
                content.style.display = 'none';
                icon.classList.add('rotated');
            }
        }
    </script>

    <script src="{% static 'js/main.js' %}"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</body>
</html>
